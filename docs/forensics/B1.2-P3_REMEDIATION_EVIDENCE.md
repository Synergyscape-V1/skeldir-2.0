# B1.2-P3 Remediation Evidence

## 1) Initial Findings (Scientific Baseline)
- Baseline target SHA on `main`: `2bc1b28b48e2c32ba555bf93a5c5b33a008ac193`.
- Baseline method:
  - Fetch branch-protection required contexts from `main`.
  - Fetch check runs for the exact SHA.
  - Compute required-context coverage matrix (`required -> latest conclusion`).
- Baseline result:
  - RS256, bounded refresh, and no-secret-fetch proofs were implemented in code/tests.
  - `main` required-check plane was **not yet scientifically green** because `Phase 8 Regression Gate (Full Physics)` was missing for this SHA.

## 2) Remediations Applied
- JWT verification standardization:
  - Enforced RS256-only verification and reject paths for HS256/`alg:none`.
  - Split key duties: verifier uses `AUTH_JWT_PUBLIC_KEY_RING`, signer uses `AUTH_JWT_SECRET`.
  - Added bounded unknown-`kid` debounce and forced-refresh negative control toggle (`SKELDIR_B12_P3_FORCE_PER_REQUEST_VERIFIER_REFRESH`).
- Test and CI hardening:
  - Added HTTP + worker + direct verifier no-secret-fetch proofs.
  - Added non-vacuous negative controls that must fail when forced into per-request verifier refresh.
  - Bound unknown-`kid` flood/debounce proof into merge-blocking CI checks.
- Full-physics required-check execution remediation:
  - Identified runner-label starvation (`ubuntu-8core`) for workflow-dispatch runs.
  - Cancelled stuck/invalid dispatches and re-dispatched `b07-phase8-full-physics-staging.yml` with `runner_label=ubuntu-latest`.

## 3) End-to-End CI Validation on Main
- Validation method:
  - Re-fetch `main` SHA and check runs after full-physics rerun completion.
  - Recompute required-context matrix against `contracts-internal/governance/b03_phase2_required_status_checks.main.json`.
- Validation outcome:
  - `all_required_contexts_green = true` for SHA `2bc1b28b48e2c32ba555bf93a5c5b33a008ac193`.
- Evidence artifacts:
  - `docs/forensics/evidence/b12_p3/main_required_checks_validation.json`
  - `docs/forensics/evidence/b12_p3/required_checks_matrix_main.tsv`

## 4) Full-Physics Dispatch Trace
- Cancelled run (initial, incomplete):  
  - https://github.com/Synergyscape-V1/skeldir-2.0/actions/runs/22545707040
- Cancelled run (queued on unavailable label):  
  - https://github.com/Synergyscape-V1/skeldir-2.0/actions/runs/22545912450
- Successful run (rerun with `runner_label=ubuntu-latest`):  
  - https://github.com/Synergyscape-V1/skeldir-2.0/actions/runs/22546072511

## 5) Exit Gate Mapping
### Exit Gate 1 - Cryptographic Contract Lock (RS256-only)
- Proof tests:
  - `backend/tests/test_b12_p3_jwt_verification_standardization.py::test_rs256_token_is_accepted`
  - `backend/tests/test_b12_p3_jwt_verification_standardization.py::test_hs256_token_is_rejected`
  - `backend/tests/test_b12_p3_jwt_verification_standardization.py::test_alg_none_token_is_rejected`
- CI jobs:
  - `JWT Tenant Context Invariants`
  - `Phase 1 Negative Controls`

### Exit Gate 2 - Hot-Path External Fetch Elimination
- Proof tests:
  - `backend/tests/test_b12_p3_jwt_verification_standardization.py::test_verification_steady_state_does_not_read_secret_source`
  - `backend/tests/test_b12_p3_jwt_verification_standardization.py::test_http_plane_steady_state_does_not_read_secret_source`
  - `backend/tests/test_b12_p3_jwt_verification_standardization.py::test_worker_plane_uses_same_verifier_and_no_fetch`
- Negative controls:
  - Forced per-request refresh must fail proof tests in `scripts/contracts/run_negative_controls.sh`.

### Exit Gate 3 - Bounded Refresh + Unknown-kid Debounce
- Proof tests:
  - `backend/tests/test_b11_p3_jwt_rotation_semantics.py::test_unknown_kid_forces_debounced_refresh_and_recovers`
  - `backend/tests/test_b11_p3_jwt_rotation_semantics.py::test_unknown_kid_refresh_is_debounced_under_flood`
  - `backend/tests/test_b11_p3_jwt_rotation_semantics.py::test_unknown_kid_refresh_failure_degrades_to_bounded_fallback`
- CI jobs:
  - `JWT Tenant Context Invariants`
  - `b11-p3-crypto-rotation-gates`

### Exit Gate 4 - Cross-plane Parity
- Worker verifier path delegates to shared primitive:
  - `app.tasks.context.decode_worker_auth_token -> app.security.auth.decode_and_verify_jwt`
- Proof tests:
  - `backend/tests/test_b12_p3_jwt_verification_standardization.py::test_worker_plane_uses_same_verifier_and_no_fetch`

### Exit Gate 5 - CI Enforcement Plane Compliance
- Required checks source-of-truth:
  - `contracts-internal/governance/b03_phase2_required_status_checks.main.json`
- Empirical proof:
  - `docs/forensics/evidence/b12_p3/required_checks_matrix_main.tsv` shows every required context in `success` state for target `main` SHA.
