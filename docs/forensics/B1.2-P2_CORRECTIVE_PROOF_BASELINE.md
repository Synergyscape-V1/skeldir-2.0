# B1.2-P2 Corrective Proof Baseline

## Scope

Pre-remediation baseline for Users Registry least-privilege corrective action (H01-H05).

- Baseline capture source: local SQL probe against `postgresql://postgres@127.0.0.1:5432/postgres`
- Raw capture artifact: `tmp_b12_p2_corrective_baseline_pre.json`
- Capture date: 2026-02-28

## A) Role posture proof (H03)

Command:

```sql
SELECT rolname, rolsuper, rolbypassrls
FROM pg_roles
WHERE rolname IN ('app_user','app_rw','app_ro')
ORDER BY rolname;
```

Output:

```json
[
  {"rolname":"app_ro","rolsuper":false,"rolbypassrls":false},
  {"rolname":"app_rw","rolsuper":false,"rolbypassrls":false},
  {"rolname":"app_user","rolsuper":false,"rolbypassrls":false}
]
```

Verdict: role posture was not the immediate blocker in baseline capture.

## B) Privilege proof on `users` (H01)

Commands:

```sql
SELECT grantee, privilege_type
FROM information_schema.role_table_grants
WHERE table_schema='public' AND table_name='users'
ORDER BY grantee, privilege_type;

SELECT
  has_table_privilege('app_user','public.users','SELECT') AS app_user_select,
  has_table_privilege('app_rw','public.users','SELECT') AS app_rw_select,
  has_table_privilege('app_ro','public.users','SELECT') AS app_ro_select;
```

Output excerpt:

```json
{
  "app_user_select": true,
  "app_rw_select": true,
  "app_ro_select": true
}
```

Verdict: validated H01. `users` was directly readable by `app_rw` and `app_ro`.

## C) RLS posture on `users` (H02)

Commands:

```sql
SELECT relrowsecurity, relforcerowsecurity
FROM pg_class
WHERE oid='public.users'::regclass;

SELECT policyname, cmd
FROM pg_policies
WHERE schemaname='public' AND tablename='users'
ORDER BY policyname;
```

Output:

```json
{
  "relrowsecurity": false,
  "relforcerowsecurity": false,
  "policies": []
}
```

Verdict: validated H02. `users` had no RLS protection and no self-only policy.

## D) Lookup boundary existence (H04)

Command:

```sql
SELECT routine_schema, routine_name, security_type
FROM information_schema.routines
WHERE routine_schema='auth' AND routine_name='lookup_user_by_login_hash';
```

Output:

```json
[]
```

Verdict: validated H04. No DB-enforced tenantless lookup boundary existed.

## E) Schema invariant check (H05)

Command:

```sql
SELECT column_name
FROM information_schema.columns
WHERE table_schema='public' AND table_name='users'
ORDER BY ordinal_position;
```

Output excerpt:

```json
["id","login_identifier_hash","external_subject_hash","auth_provider","is_active","created_at","updated_at"]
```

Verdict: H05 not observed at baseline (`users.tenant_id` absent).
